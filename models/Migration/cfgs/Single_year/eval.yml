# Scatter plot
discrepancy:
  based_on:
    - .creator.multiverse
    - .plot.facet_grid.scatter
  select_and_combine:
    fields:
      prediction:
        path: pred_net_migration
        transform:
          - .drop_sel: [ !dag_prev , { i: 'Holy See' } ]
      loss: loss
      true_data:
        path: net_migration
        transform:
          - .drop_sel: [ !dag_prev , { i: 'Holy See' } ]
  transform:
    - .isel_with_drop: [ !dag_tag prediction, { epoch: -1 } ]
    - sub: [ !dag_prev , !dag_tag true_data ]
    - xr.Dataset:
        - true_data: !dag_tag true_data
          Prediction: !dag_node -2
          Prediction error: !dag_prev
      tag: data

    # Plot a line through the origin
    - .to_array: [!dag_prev ]
    - .max: [!dag_prev ]
    - .min: [!dag_node -2]
    - np.linspace: [!dag_prev , !dag_node -2, 2 ]
      tag: line_data

  x: true_data
  y: Prediction
  hue: Prediction error
  col: seed
  cmap:
    from_values:
      0: !dag_result c_red
      0.25: !dag_result c_yellow
      0.5: !dag_result c_lightgreen
      0.75: !dag_result c_yellow
      1: !dag_result c_red
    continuous: true
  helpers:
    set_labels:
      x: True marginals $\boldsymbol{\mu}$
    call:
      functions:
        - function: [ matplotlib.pyplot, plot ]
          args: [ !dag_result line_data, !dag_result line_data ]
          lw: 1
          color: !dag_result c_lightgrey
          linestyle: 'dotted'
          zorder: -1
  style:
    figure.figsize: [!dag_result half_width, !dag_result half_width]

# In and outflow of country
countries: !pspace
  based_on: country_stats
  dag_options:
    define:
      country: !sweep
        default: UK
        values: [USA, UK, China, Germany, Mexico]
  figsize: [!dag_result full_width, !dag_result third_width]

net_migration:
  based_on: net_migration
  universes:
    seed: 0
  figsize: [ !dag_result full_width, !dag_result third_width ]